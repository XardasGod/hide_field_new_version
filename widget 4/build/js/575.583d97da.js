"use strict";(self["webpackChunkstarterpackapp"]=self["webpackChunkstarterpackapp"]||[]).push([[575],{2575:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var i=s(641),n=s(33);const a=e=>((0,i.Qi)("data-v-affb0bd2"),e=e(),(0,i.jt)(),e),o={class:"settings_container"},l={key:0,class:"accessInfo"},r=a((()=>(0,i.Lk)("a",{href:"https://widgetsfree.crm82.ru/hide_fields_tutorial.pdf",target:"_blank",style:{"font-weight":"600"}},"Инструкция",-1))),c=a((()=>(0,i.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 100 100"},[(0,i.Lk)("rect",{x:"43.75",y:"0",width:"10",height:"100",fill:"#5e5e5e",rx:"5"}),(0,i.Lk)("rect",{x:"0",y:"43.75",width:"100",height:"10",fill:"#5e5e5e",rx:"5"})],-1))),d=[c];function p(e,t,s,a,c,p){const u=(0,i.g2)("Setting");return(0,i.uX)(),(0,i.CE)("div",o,[e.accessInfo?((0,i.uX)(),(0,i.CE)("span",l,(0,n.v_)("active"===e.accessInfo.status?`Оплаченный период:\n            ${e.accessInfo.days} дней`:`Тестовый период: ${e.accessInfo.days} дней`),1)):(0,i.Q3)("",!0),r,e.is_admin?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.settings,((t,s)=>((0,i.uX)(),(0,i.Wv)(u,{input:e.settings[s],selectedFields:e.getSelectedFields(),onOutput:t=>{e.settings[s]={...JSON.parse(JSON.stringify(t)),id:e.settings[s].id}},onDelete:t=>e.deleteSetting(s),key:t.id},null,8,["input","selectedFields","onOutput","onDelete"])))),128)),(0,i.Lk)("button",{class:"settings_add_button",onClick:t[0]||(t[0]=t=>e.settings.push({id:Date.now()}))},d)],64)):(0,i.Q3)("",!0)])}var u=s(1528),f=s(9320);const h=e=>((0,i.Qi)("data-v-c9f98c6e"),e=e(),(0,i.jt)(),e),m={class:"settingCard"},g=(0,i.Fv)('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="16" height="16" viewBox="0 0 256 256" xml:space="preserve" data-v-c9f98c6e><defs data-v-c9f98c6e></defs><g style="stroke:none;stroke-width:0;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:none;fill-rule:nonzero;opacity:1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" data-v-c9f98c6e><path d="M 68.842 90 H 21.158 c -4.251 0 -7.696 -3.446 -7.696 -7.696 v -52.09 h 63.077 v 52.09 C 76.538 86.554 73.092 90 68.842 90 z" style="stroke:none;stroke-width:1;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:rgb(188,60,60);fill-rule:nonzero;opacity:1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" data-v-c9f98c6e></path><path d="M 78.321 22.213 H 11.679 c -2.209 0 -4 -1.791 -4 -4 s 1.791 -4 4 -4 h 66.643 c 2.209 0 4 1.791 4 4 S 80.53 22.213 78.321 22.213 z" style="stroke:none;stroke-width:1;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:rgb(188,60,60);fill-rule:nonzero;opacity:1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" data-v-c9f98c6e></path><path d="M 57.815 22.213 h -25.63 c -2.209 0 -4 -1.791 -4 -4 V 7.696 C 28.185 3.453 31.637 0 35.881 0 h 18.238 c 4.244 0 7.696 3.453 7.696 7.696 v 10.517 C 61.815 20.422 60.024 22.213 57.815 22.213 z M 36.185 14.213 h 17.63 V 8 h -17.63 V 14.213 z" style="stroke:none;stroke-width:1;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:rgb(188,60,60);fill-rule:nonzero;opacity:1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" data-v-c9f98c6e></path><path d="M 54.784 78.235 c -2.209 0 -4 -1.791 -4 -4 V 44.976 c 0 -2.209 1.791 -4 4 -4 s 4 1.791 4 4 v 29.259 C 58.784 76.444 56.993 78.235 54.784 78.235 z" style="stroke:none;stroke-width:1;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:rgb(255,255,255);fill-rule:nonzero;opacity:1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" data-v-c9f98c6e></path><path d="M 35.216 78.235 c -2.209 0 -4 -1.791 -4 -4 V 44.976 c 0 -2.209 1.791 -4 4 -4 s 4 1.791 4 4 v 29.259 C 39.216 76.444 37.425 78.235 35.216 78.235 z" style="stroke:none;stroke-width:1;stroke-dasharray:none;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;fill:rgb(255,255,255);fill-rule:nonzero;opacity:1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" data-v-c9f98c6e></path></g></svg>',1),v=[g],k={class:"dropdown"},w=["value"],y={key:0,ref:"dropdownList",class:"dropdown-content"},b=["onClick"],C={key:0,style:{"margin-top":"8px",display:"flex","flex-direction":"column",gap:"4px"}},_=h((()=>(0,i.Lk)("p",null,"Выберите воронку в которой хотите скрыть поля:",-1))),F=h((()=>(0,i.Lk)("p",null,"Выберите менеджеро для которых хотите скрыть поля:",-1)));function x(e,t,s,a,o,l){const r=(0,i.g2)("a-select"),c=(0,i.g2)("a-avatar");return(0,i.uX)(),(0,i.CE)("div",m,[(0,i.Lk)("button",{class:"delete_button",onClick:t[0]||(t[0]=t=>e.$emit("delete"))},v),(0,i.Lk)("div",k,[(0,i.Lk)("input",{type:"text",placeholder:"Выберите поле",onFocus:t[1]||(t[1]=t=>e.showDropdown=!0),value:e.nameBuffer,onInput:t[2]||(t[2]=(...t)=>e.filterOptions&&e.filterOptions(...t))},null,40,w),e.showDropdown?((0,i.uX)(),(0,i.CE)("div",y,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.filteredCustomFieldsOptions,(t=>((0,i.uX)(),(0,i.CE)("div",{onClick:s=>e.selectOption(t),key:t},(0,n.v_)(t),9,b)))),128))],512)):(0,i.Q3)("",!0)]),e.fieldConfig.name?((0,i.uX)(),(0,i.CE)("div",C,[_,(0,i.bF)(r,{class:"select_width",value:e.fieldConfig.pipelines,"onUpdate:value":t[3]||(t[3]=t=>e.fieldConfig.pipelines=t),options:e.pipelineOptions,optionFilterProp:"label",mode:"multiple",showSearch:""},null,8,["value","options"]),F,(0,i.bF)(r,{class:"select_width",value:e.fieldConfig.managers,"onUpdate:value":t[4]||(t[4]=t=>e.fieldConfig.managers=t),options:e.userOptions,mode:"multiple",optionFilterProp:"label",showSearch:""},{option:(0,i.k6)((({label:e,avatar:t})=>[(0,i.bF)(c,{src:t,size:20,style:{"margin-right":"5px"}},null,8,["src"]),(0,i.eW)(" "+(0,n.v_)(e),1)])),_:1},8,["value","options"])])):(0,i.Q3)("",!0)])}const O=(0,i.pM)({data(){return{isBold:!1,color:null,nameBuffer:"",fieldConfig:{pipelines:[],managers:[],name:""},pipelineOptions:[],userOptions:(()=>{const e=AMOCRM.constant("managers"),t=Object.values(e);return t.filter((e=>!0===e.active)).map((e=>({label:e.title,avatar:e.avatar,value:Number(e.id)})))})(),showDropdown:!1,customFields:(()=>{const e=APP.constant("account").cf,t=Object.values(e);return t.map((e=>e.NAME))})(),filteredCustomFieldsOptions:[]}},props:{input:null,selectedFields:[]},watch:{isBold:{handler(){this.updateStyle()}},color:{handler(){this.updateStyle()}},fieldConfig:{handler(){this.$emit("output",this.fieldConfig)},deep:!0}},async created(){this.filteredCustomFieldsOptions=this.customFields,this.input.hasOwnProperty("name")&&(delete this.input.id,this.fieldConfig=this.input,this.nameBuffer=this.input.name);try{const e=await fetch(window.location.origin+"/api/v4/leads/pipelines"),t=await e.json();this.pipelineOptions=t._embedded.pipelines.map((e=>({label:e.name,value:Number(e.id)})))}catch(e){}},methods:{filterOptions(e){this.nameBuffer=e.target.value;const t=e.target.value.toLowerCase();this.filteredCustomFieldsOptions=this.customFields.filter((e=>e.toLowerCase().includes(t))).filter((e=>!this.selectedFields.includes(e)))},selectOption(e){this.fieldConfig.name=e,this.nameBuffer=e,this.showDropdown=!1}}});var S=s(6262);const I=(0,S.A)(O,[["render",x],["__scopeId","data-v-c9f98c6e"]]),j=I,z=(0,i.pM)({setup(){const{app:e}=(0,i.nI)().appContext;e.use(u.Ay),e.use(f.Ay)},components:{Setting:j},data(){return{is_admin:APP.constant("user_rights").is_admin,accessInfo:null,settings:[{id:Date.now()}],configInput:{}}},watch:{settings:{handler(){this.updateSettings()},deep:!0}},async created(){if(await this.getData(),this.filteredCustomFieldsOptions=this.customFields,this.configInput=document.querySelector('input[name="fieldsConfig"]'),this.configInput.value){const e=JSON.parse(this.configInput.value);Array.isArray(e)?this.settings=e:this.settings=Object.values(e)}},methods:{async getData(){try{const e=await fetch("https://widgetsfree.crm82.ru/api/widget/hide_fields/access_info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subdomain:APP.constant("account").subdomain})});if(e.ok){const t=await e.json();this.accessInfo=t.access_info,localStorage.removeItem("crm82_hide_fields"),document.querySelector("#loading_widget").remove()}else 402===e.status?(localStorage.setItem("crm82_hide_fields","pay_me"),document.querySelector("#loading_widget span").innerHTML='\n                            <div style="display: flex; justify-content: space-between;">\n                                <span style="font-weight: 600;">Срок действия виджета истек. Свяжитесь с нами для оплаты</span>\n                            </div>\n                            <br>\n                            <span>Стоимость: 1000 руб в месяц</span><br>\n                            <span style="display: flex; align-items: center; gap: 0.25rem;">\n                                <span>Оплатить: </span>\n                                <a href="https://t.me/rudolf_crm" target="_blank" style="display: flex; align-items: center; gap: 0.25rem;">\n                                    @rudolf_crm\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 240.1 240.1">\n                                        <circle fill="#2AABEE" cx="120.1" cy="120.1" r="120.1" />\n                                        <path fill="#FFFFFF" d="M54.3,118.8c35-15.2,58.3-25.3,70-30.2 c33.3-13.9,40.3-16.3,44.8-16.4c1,0,3.2,0.2,4.7,1.4c1.2,1,1.5,2.3,1.7,3.3s0.4,3.1,0.2,4.7c-1.8,19-9.6,65.1-13.6,86.3 c-1.7,9-5,12-8.2,12.3c-7,0.6-12.3-4.6-19-9c-10.6-6.9-16.5-11.2-26.8-18c-11.9-7.8-4.2-12.1,2.6-19.1c1.8-1.8,32.5-29.8,33.1-32.3 c0.1-0.3,0.1-1.5-0.6-2.1c-0.7-0.6-1.7-0.4-2.5-0.2c-1.1,0.2-17.9,11.4-50.6,33.5c-4.8,3.3-9.1,4.9-13,4.8 c-4.3-0.1-12.5-2.4-18.7-4.4c-7.5-2.4-13.5-3.7-13-7.9C45.7,123.3,48.7,121.1,54.3,118.8z" />\n                                    </svg>\n                                </a>\n                            </span>\n                        '):document.querySelector("#loading_widget").remove()}catch(e){}},deleteSetting(e){this.settings.splice(e,1)},updateSettings(){this.configInput.value=JSON.stringify(this.settings),this.configInput.dispatchEvent(new Event("change",{bubbles:!0}))},getSelectedFields(){return this.settings.map((e=>e.name))}}}),E=(0,S.A)(z,[["render",p],["__scopeId","data-v-affb0bd2"]]),L=E}}]);
//# sourceMappingURL=575.583d97da.js.map