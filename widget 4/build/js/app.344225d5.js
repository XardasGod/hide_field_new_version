(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["starterpackapp"]=t():e["starterpackapp"]=t()})(self,(()=>(()=>{"use strict";var e={},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.m=e,(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[]))})(),(()=>{n.u=e=>"js/"+e+"."+{575:"583d97da",751:"8c14d256",756:"de8f6b26",938:"8568e45c"}[e]+".js"})(),(()=>{n.miniCssF=e=>"css/"+e+".0fc1d70e.css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="starterpackapp:";n.l=(r,i,s,o)=>{if(e[r])e[r].push(i);else{var a,c;if(void 0!==s)for(var d=document.getElementsByTagName("script"),l=0;l<d.length;l++){var u=d[l];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+s){a=u;break}}a||(c=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+s),a.src=r),e[r]=[i];var p=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),c&&document.head.appendChild(a)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.p="https://localhost:8080/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,r,i,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",n.nc&&(o.nonce=n.nc);var a=n=>{if(o.onerror=o.onload=null,"load"===n.type)i();else{var r=n&&n.type,a=n&&n.target&&n.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+a+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=r,c.request=a,o.parentNode&&o.parentNode.removeChild(o),s(c)}};return o.onerror=o.onload=a,o.href=t,r?r.parentNode.insertBefore(o,r.nextSibling):document.head.appendChild(o),o},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var i=n[r],s=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(s===e||s===t))return i}var o=document.getElementsByTagName("style");for(r=0;r<o.length;r++){i=o[r],s=i.getAttribute("data-href");if(s===e||s===t)return i}},r=r=>new Promise(((i,s)=>{var o=n.miniCssF(r),a=n.p+o;if(t(o,a))return i();e(r,a,null,i,s)})),i={524:0};n.f.miniCss=(e,t)=>{var n={575:1};i[e]?t.push(i[e]):0!==i[e]&&n[e]&&t.push(i[e]=r(e).then((()=>{i[e]=0}),(t=>{throw delete i[e],t})))}}})(),(()=>{var e={524:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var s=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=s);var o=n.p+n.u(t),a=new Error,c=r=>{if(n.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,i[1](a)}};n.l(o,c,"chunk-"+t,t)}};var t=(t,r)=>{var i,s,[o,a,c]=r,d=0;if(o.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)c(n)}for(t&&t(r);d<o.length;d++)s=o[d],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self["webpackChunkstarterpackapp"]=self["webpackChunkstarterpackapp"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r={};function i(e){var t;function n(e){e.keyCode&&(t=e.keyCode);var n=this.selectionStart;n<3&&e.preventDefault();var r="+7 (___) ___ ____",i=0,s=r.replace(/\D/g,""),o=this.value.replace(/\D/g,""),a=r.replace(/[_\d]/g,(function(e){return i<o.length?o.charAt(i++)||s.charAt(i):e}));i=a.indexOf("_"),-1!=i&&(i<5&&(i=3),a=a.slice(0,i));var c=r.substr(0,this.value.length).replace(/_+/g,(function(e){return"\\d{1,"+e.length+"}"})).replace(/[+()]/g,"\\$&");c=new RegExp("^"+c+"$"),(!c.test(this.value)||this.value.length<5||t>47&&t<58)&&(this.value=a),"blur"==e.type&&this.value.length<5&&(this.value="")}e.addEventListener("input",n,!1),e.addEventListener("focus",n,!1),e.addEventListener("blur",n,!1),e.addEventListener("keydown",n,!1)}function s(e){return e.length>=18?e.slice(0,-1):e}function o(e){const t=/^\+7 \(\d{3}\) \d{3} \d{4}$/;return t.test(e)}async function a(e,t){try{const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error("Network response was not ok: "+n.statusText)}catch(n){}}function c(e,t){const n=document.createElement("div");n.classList.add("widget_settings_block__item_field");const r=document.createElement("div");r.classList.add("widget_settings_block__title_field"),r.textContent="Для активации виджета введите свой номер телефона для тех. поддержки",n.appendChild(r);const c=document.createElement("input");c.classList.add("widget_settings_block__controls__","text-input"),n.appendChild(c);const d=document.createElement("div");d.classList.add("widget_settings_block__error","widget_settings_block__errorphone"),d.textContent="Пожалуйста укажите свой номер телефона для технической поддержки",d.style.display="none",n.appendChild(d),e.appendChild(n);const l=document.querySelector(".js-widget-save");l.setAttribute("disabled","");let u=null;c.addEventListener("input",(e=>{u=s(e.target.value);const t=o(u);t?(l.removeAttribute("disabled"),d.style.display="none"):(l.setAttribute("disabled",""),d.style.display="block")})),l.addEventListener("click",(async()=>{await a({phone:u,subdomain:APP.constant("account").subdomain,amoId:APP.constant("account").id,users:Object.values(APP.constant("account").users).length,paymentTill:APP.constant("account").paid_till,tariff:APP.constant("account").tariffName},t)})),i(c)}n.r(r),n.d(r,{default:()=>l});class d{constructor(e){this.amoWidget=e,this.cardObserver=null}async customizeFields(){let e=this.amoWidget.get_settings().fieldsConfig;const t=localStorage.getItem("crm82_hide_fields");if("leads_card"===APP.getWidgetsArea()&&e&&"pay_me"!==t){"string"===typeof e&&(e=Object.values(JSON.parse(this.amoWidget.get_settings().fieldsConfig)));for(const t of e)this.customize(t)}await this.checkPayment()}async customize(e){const t=await this.getPipelineId();if(-1!=e.pipelines.indexOf(t)&&-1!=e.managers.indexOf(APP.constant("user").id)){const t=document.querySelectorAll(`.linked-form__field__label[title="${e.name}"]`);for(const e of t)e.style.display="none"}}async getPipelineId(){const e=window.location.pathname.split("/").pop();try{const t=await fetch(`/api/v4/leads/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const n=await t.json(),r=n.pipeline_id;return r}catch(t){}}async checkPayment(){try{const e=await fetch("https://widgetsfree.crm82.ru/api/widget/hide_fields/access_info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subdomain:APP.constant("account").subdomain})});if(200===e.status)localStorage.removeItem("crm82_hide_fields");else if(402===e.status){localStorage.setItem("crm82_hide_fields","pay_me");const e={header:"Скрытие полей CRM82",text:"Срок действия виджета истек. Перейдите в настройки для оплаты"};AMOCRM.notifications.show_message_error(e)}}catch(e){}}async mountSettings(){const e=document.createElement("div");e.innerHTML='<div style="position:absolute; left:0; right:0; top:0; bottom:0; display:flex; justify-content:center; align-items:center; background-color:white; z-index: 999"><span>Загрузка...</span></div>',e.id="loading_widget";const t=document.querySelector(".widget_settings_block__descr");t.innerHTML="",t.parentElement.appendChild(e),this.vueApp=await this.createApp((()=>Promise.all([n.e(751),n.e(938),n.e(575)]).then(n.bind(n,2575)))),this.vueApp.mount(t);try{const e=await fetch("https://widgetsfree.crm82.ru/api/widget/hide_fields/access_info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subdomain:APP.constant("account").subdomain})});401===e.status&&(t.removeChild(t.lastChild),c(t,"https://widgetsfree.crm82.ru/api/widget/hide_fields/phone"))}catch(r){}}async createApp(e,t){const{createApp:r,defineAsyncComponent:i}=await Promise.all([n.e(751),n.e(756)]).then(n.bind(n,8756));return r(i(e),t)}addCardObserver(){this.cardObserver&&this.cardObserver.disconnect(),this.cardObserver=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{"card_fields"===e.id&&this.customizeFields(),e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("button-input__saved")&&this.customizeFields()}))}))}));const e=document.querySelector("#card_holder");this.cardObserver.observe(e,{childList:!0,subtree:!0})}forRenderFunction(){this.cardObserver||(this.customizeFields(),this.addCardObserver())}}function l(e){let t;const r=async()=>(n.p=`${e.params.path}/build/`,t||(t=new d(e)),t);return e.callbacks={settings:async function(){(await r()).mountSettings()},init:async function(){return(await r()).addCardObserver(),!0},bind_actions:function(){return!0},render:async function(){return(await r()).forRenderFunction(),!0},dpSettings:function(){},advancedSettings:function(){},destroy:function(){},contacts:{selected:function(){}},onSalesbotDesignerSave:function(e,t){},leads:{selected:function(){}},todo:{selected:function(){}},onSave:function(){return!0},onAddAsSource:function(e){}},e}return r})()));
//# sourceMappingURL=app.344225d5.js.map